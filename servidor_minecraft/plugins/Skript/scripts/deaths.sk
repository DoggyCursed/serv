# Asignar 3 vidas y 0 muertes la primera vez que entra
on first join:
    set {vidas::%player%} to 3
    set {muertes::%player%} to 0
    send "&7ðŸ‘¤ Se te han asignado &c3 vidas&7. Â¡Ten cuidado!"

# Evento al morir un jugador
on death of player:
    add 1 to {muertes::%victim%}
    remove 1 from {vidas::%victim%}

    # Primero guarda el mensaje antes de borrarlo
    set {_msg} to uncolored death message
    set death message to ""

    # Mensaje por defecto
    set {_texto} to "ha muerto en circunstancias misteriosas."

    # Si muriÃ³ por un jugador
    if attacker is player:
        set {_texto} to "fue eliminado por &c%attacker%&7, y todos juzgamos su habilidad de combate."

    # Mensajes especÃ­ficos
    else if {_msg} contains "tried to swim in lava":
        set {_texto} to "probÃ³ el jacuzzi de lava y se arrepintiÃ³."
    else if {_msg} contains "fell from a high place":
        set {_texto} to "se tirÃ³ sin paracaÃ­das."
    else if {_msg} contains "drowned":
        set {_texto} to "pensÃ³ que era un pez."
    else if {_msg} contains "was slain by":
        set {_texto} to "fue apuÃ±alado sin piedad por un enemigo."
    else if {_msg} contains "was shot by":
        set {_texto} to "recibiÃ³ un flechazo en toda la cara."
    else if {_msg} contains "blown up by":
        set {_texto} to "volÃ³ por los aires gracias a un Creeper con exceso de cariÃ±o."
    else if {_msg} contains "went up in flames":
        set {_texto} to "se prendiÃ³ como antorcha humana."
    else if {_msg} contains "burned to death":
        set {_texto} to "se cocinÃ³ lentamente como un pollo al horno."
    else if {_msg} contains "suffocated":
        set {_texto} to "se enterrÃ³ vivo por accidente."
    else if {_msg} contains "fell out of the world":
        set {_texto} to "explorÃ³ el vacÃ­o... para siempre."
    else if {_msg} contains "froze to death":
        set {_texto} to "se convirtiÃ³ en paleta congelada."
    else if {_msg} contains "was struck by lightning":
        set {_texto} to "fue bendecido por Zeus con un rayo fulminante."
    else if {_msg} contains "withered away":
        set {_texto} to "se marchitÃ³ como flor triste."
    else if {_msg} contains "was killed by magic":
        set {_texto} to "jugÃ³ con magia y perdiÃ³."
    else if {_msg} contains "starved to death":
        set {_texto} to "olvidÃ³ que la comida existÃ­a."
    else if {_msg} contains "was pricked to death":
        set {_texto} to "se abrazÃ³ a un cactus sin pensarlo mucho."
    else if {_msg} contains "was impaled":
        set {_texto} to "probÃ³ el filo de algo muy puntiagudo."
    else if {_msg} contains "was fireballed by":
        set {_texto} to "fue incinerado por una bola de fuego con amor."
    else if {_msg} contains "sonically-charged shriek":
        set {_texto} to "descubriÃ³ el canto mortal del Warden."

    # Mensaje global con singular/plural
    if {vidas::%victim%} = 1:
        broadcast "&8[&câœ–&8] &6%victim% &7%{_texto}% &cLe queda &f1 &cvida."
    else:
        broadcast "&8[&câœ–&8] &6%victim% &7%{_texto}% &cLe quedan &f%{vidas::%victim%}% &cvidas."

    # Efectos y avisos
    if {vidas::%victim%} > 0:
        loop all players:
            play sound "block.portal.trigger" with volume 1 and pitch 1 at loop-player

        if {vidas::%victim%} = 1:
            send "&câš  Te queda &f1 &cvida. Â¡Cuidado!" to victim
        else:
            send "&câš  Te quedan &f%{vidas::%victim%}% &cvidas." to victim

        send "&7âœ– Has muerto &f%{muertes::%victim%}% &7veces." to victim

    else:
        loop all players:
            play sound "block.end_portal.spawn" with volume 1 and pitch 1 at loop-player

        send "&4âœ– Te has quedado sin vidas. Â¡Has sido baneado!" to victim
        broadcast "&8[&4âœ–&8] &c%victim% &7se ha quedado sin vidas y fue expulsado del servidor."
        execute console command "ban %victim% Se te acabaron las 3 vidas."

# Comando para dar vidas
command /darvidas <player> <number>:
    permission: vidas.admin
    trigger:
        set {vidas::%arg-1%} to arg-2
        send "&aâœ” Has dado &f%arg-2% &avidas a &f%arg-1%&a."
        send "&7âž¤ Tus vidas han sido restablecidas a &f%arg-2%&7." to arg-1

# Comando para resetear vidas y muertes
command /resetvidas <player>:
    permission: vidas.admin
    trigger:
        set {vidas::%arg-1%} to 3
        set {muertes::%arg-1%} to 0
        send "&aâœ” Has reseteado las vidas y muertes de &f%arg-1%&a."
        send "&7âž¤ Tus vidas y muertes han sido reiniciadas." to arg-1